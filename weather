<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å†¬å¤©ç»™äºˆæ¸©æš– Â· Winter Glow React Ultimate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React 18 UMD + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

  <style>
    :root {
      --bg-night-cold-1: #020617;
      --bg-night-cold-2: #0b1120;
      --bg-night-warm-1: #111827;
      --bg-night-warm-2: #7c2d12;

      --bg-snow-cold-1: #0f172a;
      --bg-snow-cold-2: #1f2937;
      --bg-snow-warm-1: #111827;
      --bg-snow-warm-2: #7c2d12;

      --bg-dusk-cold-1: #1e1b4b;
      --bg-dusk-cold-2: #7c2d12;
      --bg-dusk-warm-1: #7c2d12;
      --bg-dusk-warm-2: #b45309;

      --txt-main: #e5e7eb;
      --txt-sub: #9ca3af;

      --warm: #fb923c;
      --warm-soft: #fed7aa;
      --cold: #60a5fa;
      --cold-soft: #bfdbfe;

      --glass-bg: rgba(15, 23, 42, 0.6);
      --glass-border: rgba(148, 163, 184, 0.7);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0b1120, #020617);
      color: var(--txt-main);
      cursor: none;
      overflow-x: hidden;
      overflow-y: auto;
    }

    #root { height: 100%; }

    /* å…‰æ ‡å…‰æ™• */
    .cursor-glow {
      position: fixed;
      width: 220px;
      height: 220px;
      pointer-events: none;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(251, 146, 60, 0.55), transparent 70%);
      mix-blend-mode: screen;
      opacity: 0.9;
      transform: translate3d(-9999px, -9999px, 0);
      transition: transform 0.08s linear;
      z-index: 9999;
    }

    /* å…‰æ ‡é™„è¿‘ç²’å­ */
    .cursor-particle {
      position: fixed;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      pointer-events: none;
      background: radial-gradient(circle, rgba(248,250,252,0.95), transparent 60%);
      mix-blend-mode: screen;
      animation: cursorParticle 0.7s ease-out forwards;
      z-index: 9998;
    }

    @keyframes cursorParticle {
      from {
        transform: translate3d(0, 0, 0) scale(1);
        opacity: 1;
      }
      to {
        transform: translate3d(var(--dx), var(--dy), 0) scale(0.4);
        opacity: 0;
      }
    }

    /* åº”ç”¨æ•´ä½“å®¹å™¨ */
    .app {
      position: relative;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 20px 32px 40px;
      transition: background 0.6s ease, filter 0.3s ease;
      overflow: hidden;
    }

    @media (max-width: 900px) {
      .app { padding: 14px 18px 32px; }
    }

    /* çƒŸé›¾å±‚ï¼ˆå¸¦è§†å·®ï¼‰ */
    .smoke-layer {
      position: absolute;
      inset: -20%;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
      opacity: 0.4;
      transition: transform 0.25s ease-out;
    }

    .smoke-cloud {
      position: absolute;
      width: 60%;
      height: 60%;
      border-radius: 50%;
      filter: blur(40px);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.16), transparent 60%),
        radial-gradient(circle at 70% 60%, rgba(148, 163, 184, 0.22), transparent 65%);
      animation: smokeMove 36s ease-in-out infinite alternate;
    }

    .smoke-cloud.smoke-2 {
      left: 40%;
      top: 10%;
      animation-duration: 44s;
      animation-direction: alternate-reverse;
      opacity: 0.7;
    }

    @keyframes smokeMove {
      0%   { transform: translate3d(-12%, 8%, 0) scale(1); }
      50%  { transform: translate3d(8%, -4%, 0) scale(1.12); }
      100% { transform: translate3d(12%, 16%, 0) scale(1.04); }
    }

    /* é¡¶æ  */
    .top-bar {
      position: relative;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .logo-block {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-mark {
      width: 28px;
      height: 28px;
      border-radius: 11px;
      background:
        conic-gradient(from 220deg, #38bdf8, #fb923c, #a855f7, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 18px rgba(59,130,246,0.7);
    }

    .logo-mark::after {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: 9px;
      background: radial-gradient(circle at 20% 0%, rgba(255,255,255,0.9), transparent 52%);
      opacity: 0.9;
    }

    .logo-text-main { font-size: 16px; font-weight: 600; }
    .logo-text-sub { font-size: 11px; color: var(--txt-sub); }

    .top-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .small-text { font-size: 12px; color: var(--txt-sub); }

    /* ç»ç’ƒæŒ‰é’® */
    .glass-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      backdrop-filter: blur(14px);
      color: var(--txt-main);
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.18s ease;
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.6),
        0 18px 40px rgba(15,23,42,0.9);
    }

    .glass-btn:hover {
      transform: translateY(-1.5px);
      box-shadow:
        0 0 0 1px rgba(148,163,184,0.7),
        0 22px 50px rgba(15,23,42,1);
      background: linear-gradient(
        135deg,
        rgba(248,250,252,0.12),
        rgba(15,23,42,0.9)
      );
    }

    .glass-btn.small {
      padding: 6px 12px;
      font-size: 12px;
      box-shadow: none;
    }

    .dot-live {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 14px rgba(34,197,94, 0.9);
    }

    /* ä¸»å†…å®¹åŒºåŸŸï¼ˆç‰¹æ•ˆ heroï¼‰ */
    .content {
      position: relative;
      z-index: 2;
      display: flex;
      gap: 32px;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 40px;
    }

    @media (max-width: 900px) {
      .content {
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        padding-top: 10px;
      }
    }

    .left {
      max-width: 520px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .tag-line {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: radial-gradient(circle at top left, rgba(148,163,184,0.45), rgba(15,23,42,0.9));
      font-size: 11px;
      color: var(--cold-soft);
    }

    .tag-pill {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
      color: var(--warm-soft);
      font-size: 10px;
    }

    .title {
      font-size: clamp(32px, 5vw, 44px);
      line-height: 1.15;
    }

    .t-cold {
      background: linear-gradient(120deg, var(--cold-soft), var(--cold));
      -webkit-background-clip: text;
      color: transparent;
    }
    .t-warm {
      background: linear-gradient(120deg, var(--warm-soft), var(--warm));
      -webkit-background-clip: text;
      color: transparent;
    }

    .subtitle {
      font-size: 14px;
      line-height: 1.8;
      color: var(--txt-sub);
    }

    .subtitle strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 4px;
    }

    .hint-text {
      font-size: 12px;
      color: var(--txt-sub);
      margin-top: 6px;
    }

    .hint-badge {
      border-radius: 999px;
      border: 1px solid rgba(56,189,248,0.8);
      padding: 2px 8px;
      font-size: 10px;
      color: var(--cold-soft);
      margin-right: 6px;
    }

    /* å¿ƒæƒ…æ»‘æ† */
    .mood-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      font-size: 12px;
      color: var(--txt-sub);
    }

    .mood-row input[type="range"] {
      flex: 1;
      accent-color: #fb923c;
    }

    /* å³ä¾§çƒä½“ */
    .right {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 0;
    }

    .orb-wrapper {
      position: relative;
      width: min(420px, 80vw);
      aspect-ratio: 1/1;
      perspective: 900px;
      transition: transform 0.25s ease-out;
    }

    .orb {
      position: absolute;
      inset: 12%;
      border-radius: 50%;
      background:
        radial-gradient(circle at 20% 0%, rgba(255,255,255,0.7), transparent 52%),
        radial-gradient(circle at 70% 80%, rgba(251,146,60,0.75), transparent 70%),
        radial-gradient(circle at 0% 80%, rgba(56,189,248,0.5), transparent 65%),
        #020617;
      box-shadow:
        0 0 80px rgba(251,146,60,0.45),
        0 0 120px rgba(56,189,248,0.45);
      border: 1px solid rgba(148,163,184,0.7);
      transform-style: preserve-3d;
      overflow: hidden;
      transition: transform 0.12s linear, box-shadow 0.6s ease;
    }

    .orb-breathe {
      animation: breathe 4.4s ease-in-out infinite;
    }

    @keyframes breathe {
      0%   { transform: translateZ(0) scale(1); }
      40%  { transform: translateZ(16px) scale(1.04); box-shadow: 0 0 120px rgba(251,146,60,0.7), 0 0 200px rgba(56,189,248,0.65); }
      100% { transform: translateZ(0) scale(1); }
    }

    /* Three.js ç²’å­å±‚ */
    .orb-three-layer {
      position: absolute;
      inset: 10%;
      pointer-events: none;
    }

    /* ç‚¹é˜µç¯ + äº‘ */
    .dot-ring {
      position: absolute;
      inset: 6%;
      border-radius: 999px;
      border: 1px dashed rgba(148,163,184,0.6);
      box-shadow: 0 0 42px rgba(56,189,248,0.6);
    }

    .dot-ring::before,
    .dot-ring::after {
      content: "";
      position: absolute;
      inset: 12%;
      border-radius: inherit;
      border: 1px dashed rgba(148,163,184,0.4);
    }

    .dot-ring::after {
      inset: 22%;
      opacity: 0.4;
    }

    .dot-cloud {
      position: absolute;
      inset: -12%;
      border-radius: 999px;
      background-image: radial-gradient(circle, rgba(148,163,184,0.8) 1px, transparent 1px);
      background-size: 30px 30px;
      mask-image: radial-gradient(circle, black 42%, transparent 90%);
      opacity: 0.8;
      animation: dotDrift 28s linear infinite;
    }

    @keyframes dotDrift {
      from { transform: translate3d(0,0,0) rotate(0deg); }
      to   { transform: translate3d(4px,-6px,0) rotate(360deg); }
    }

    /* è¯´æ˜å¡ç‰‡ */
    .orb-card {
      position: absolute;
      right: 5%;
      bottom: 4%;
      min-width: 180px;
      padding: 10px 13px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(15,23,42,0.98), rgba(15,23,42,0.7));
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: 0 18px 40px rgba(15,23,42,0.95);
      font-size: 11px;
      color: var(--txt-sub);
      backdrop-filter: blur(18px);
    }

    .orb-card-title {
      font-size: 12px;
      color: var(--txt-main);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .orb-card-badge {
      padding: 1px 7px;
      border-radius: 999px;
      border: 1px solid rgba(248,250,252,0.7);
      font-size: 10px;
      color: var(--warm-soft);
    }

    .orb-card-temp {
      font-size: 11px;
      color: var(--cold-soft);
      margin-bottom: 3px;
    }

    /* Canvas é›ªèŠ± */
    .snow-canvas {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
    }

    /* ä¸‹æ–¹æ®µè½ç”¨äºæ»šåŠ¨è§†å·®æ•ˆæœ */
    .story-scroll {
      position: relative;
      z-index: 2;
      font-size: 12px;
      color: var(--txt-sub);
      max-width: 620px;
      margin-top: 24px;
      line-height: 1.8;
    }

    /* å¤šé¡µæ•…äº‹å¼¹çª— */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.65);
      backdrop-filter: blur(12px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99;
    }

    .modal {
      width: min(450px, 90vw);
      border-radius: 18px;
      padding: 18px 18px 14px;
      background:
        radial-gradient(circle at top left, rgba(15,23,42,0.98), rgba(15,23,42,0.9));
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: 0 24px 60px rgba(15,23,42,1);
      color: var(--txt-main);
      animation: modalIn 0.28s ease-out;
    }

    @keyframes modalIn {
      from { transform: translateY(8px) scale(0.96); opacity: 0; }
      to   { transform: translateY(0) scale(1); opacity: 1; }
    }

    .modal-title { font-size: 17px; margin-bottom: 4px; }
    .modal-sub { font-size: 11px; color: var(--txt-sub); margin-bottom: 10px; }

    .modal-body {
      font-size: 13px;
      color: var(--txt-sub);
      line-height: 1.8;
      margin-bottom: 10px;
      white-space: pre-wrap;
    }

    .dialog-line { margin-bottom: 6px; }
    .dialog-speaker {
      font-weight: 500;
      color: var(--cold-soft);
      margin-right: 6px;
    }

    .modal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .progress-dots {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: transparent;
    }

    .dot.active {
      background: #f97316;
      box-shadow: 0 0 8px rgba(249,115,22,0.9);
    }

    .modal-btn-row {
      display: flex;
      gap: 8px;
    }

    /* ====== å¤©æ°” + æ—¥å†åŒºåŸŸ ====== */
    .weather-section {
      position: relative;
      z-index: 2;
      margin-top: 12px;
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 18px;
      max-width: 1180px;
    }

    @media (max-width: 900px) {
      .weather-section {
        grid-template-columns: 1fr;
      }
    }

    .glass-card {
      border-radius: 16px;
      padding: 14px 16px;
      background: rgba(15,23,42,0.78);
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.7),
        0 18px 40px rgba(15,23,42,0.95);
      backdrop-filter: blur(16px);
    }

    .weather-main {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .weather-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .weather-city {
      font-size: 16px;
      font-weight: 500;
    }

    .weather-desc {
      font-size: 13px;
      color: var(--txt-sub);
    }

    .weather-temp-block {
      display: flex;
      align-items: baseline;
      gap: 10px;
    }

    .temp-now {
      font-size: 30px;
      font-weight: 600;
    }

    .temp-feel {
      font-size: 13px;
      color: var(--txt-sub);
    }

    .weather-meta {
      font-size: 12px;
      color: var(--txt-sub);
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,0.9);
      margin-right: 4px;
    }

    .trend-title {
      font-size: 13px;
      margin-bottom: 4px;
      color: var(--txt-sub);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .trend-chart-wrapper {
      width: 100%;
      overflow-x: auto;
      padding-bottom: 4px;
    }

    .trend-svg {
      width: 100%;
      min-width: 360px;
      height: 120px;
    }

    .trend-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 10px;
      color: var(--txt-sub);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .cal-nav-btn {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.7);
      color: var(--txt-main);
      font-size: 11px;
      cursor: pointer;
    }

    .cal-weekdays,
    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      font-size: 11px;
      text-align: center;
    }

    .cal-weekdays {
      color: var(--txt-sub);
      margin-bottom: 4px;
    }

    .cal-day {
      padding: 6px 0;
      border-radius: 8px;
      margin: 2px;
      position: relative;
      min-height: 30px;
    }

    .cal-day.empty {
      opacity: 0.15;
    }

    .cal-day.today {
      border: 1px solid #fb923c;
      box-shadow: 0 0 10px rgba(251,146,60,0.7);
    }

    .cal-day .date {
      font-size: 12px;
    }

    .cal-day .holiday {
      font-size: 10px;
      color: #fed7aa;
      margin-top: 2px;
    }

    .cal-day.holiday-day {
      background: rgba(180,83,9,0.32);
      border: 1px solid rgba(251,146,60,0.8);
    }

    .cal-legend {
      margin-top: 8px;
      font-size: 11px;
      color: var(--txt-sub);
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 4px;
      margin-right: 4px;
      display: inline-block;
      vertical-align: middle;
    }

    .legend-holiday {
      background: rgba(180,83,9,0.6);
      border: 1px solid rgba(251,146,60,0.9);
    }

    .legend-today {
      border-radius: 999px;
      background: transparent;
      border: 1px solid #fb923c;
      box-shadow: 0 0 6px rgba(251,146,60,0.7);
    }

    .footer-note {
      margin-top: 8px;
      font-size: 11px;
      color: var(--txt-sub);
    }

    @media (max-width: 600px) {
      .header-right {
        text-align: left;
      }
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;
const THREE = window.THREE;

// ===== å’Œé£å¤©æ°” KEY ä¸èŠ‚å‡æ—¥é…ç½® =====
const QWEATHER_KEY = "9f09c671816448ba8a6e514466b7c31d";

const CHINA_HOLIDAYS_2025 = {
  "2025-01-01": "å…ƒæ—¦",
  "2025-01-28": "æ˜¥èŠ‚",
  "2025-01-29": "æ˜¥èŠ‚",
  "2025-01-30": "æ˜¥èŠ‚",
  "2025-04-04": "æ¸…æ˜èŠ‚",
  "2025-05-01": "åŠ³åŠ¨èŠ‚",
  "2025-06-01": "å„¿ç«¥èŠ‚",
  "2025-10-01": "å›½åº†èŠ‚",
  "2025-10-02": "å›½åº†èŠ‚",
  "2025-10-03": "å›½åº†èŠ‚"
};

function bgTempMode(feel) {
  if (feel == null || isNaN(feel)) return "neutral";
  if (feel <= 0) return "cold";
  if (feel >= 16) return "warm";
  return "neutral";
}

// helper
function formatHourLabel(fxTime) {
  const m = fxTime.match(/T(\d{2}):/);
  if (!m) return "";
  return m[1] + ":00";
}

function toYMD(date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, "0");
  const d = String(date.getDate()).padStart(2, "0");
  return `${y}-${m}-${d}`;
}

// ===== æ—¥å†ç»„ä»¶ =====
function CalendarPanel() {
  const [currentMonth, setCurrentMonth] = useState(() => {
    const now = new Date();
    return new Date(now.getFullYear(), now.getMonth(), 1);
  });

  const today = new Date();
  const todayYMD = toYMD(today);
  const year = currentMonth.getFullYear();
  const month = currentMonth.getMonth();
  const firstDay = new Date(year, month, 1);
  const firstWeekday = firstDay.getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  const prevMonth = () => {
    setCurrentMonth(prev => new Date(prev.getFullYear(), prev.getMonth() - 1, 1));
  };
  const nextMonth = () => {
    setCurrentMonth(prev => new Date(prev.getFullYear(), prev.getMonth() + 1, 1));
  };

  const cells = [];
  for (let i = 0; i < firstWeekday; i++) {
    cells.push({ empty: true, key: "e" + i });
  }
  for (let d = 1; d <= daysInMonth; d++) {
    const date = new Date(year, month, d);
    const ymd = toYMD(date);
    const holidayName = CHINA_HOLIDAYS_2025[ymd];
    const isToday = ymd === todayYMD;
    cells.push({
      empty: false,
      day: d,
      ymd,
      holidayName,
      isToday,
      key: ymd
    });
  }

  const monthLabel = `${year} å¹´ ${(month + 1).toString().padStart(2, "0")} æœˆ`;

  return (
    <div className="glass-card">
      <div className="calendar-header">
        <span>{monthLabel}</span>
        <div>
          <button className="cal-nav-btn" onClick={prevMonth}>â—€</button>
          <button className="cal-nav-btn" onClick={nextMonth} style={{ marginLeft: 6 }}>â–¶</button>
        </div>
      </div>

      <div className="cal-weekdays">
        <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div>
        <div>å››</div><div>äº”</div><div>å…­</div>
      </div>

      <div className="cal-grid">
        {cells.map(cell => {
          if (cell.empty) return <div key={cell.key} className="cal-day empty"></div>;
          const cls = [
            "cal-day",
            cell.isToday ? "today" : "",
            cell.holidayName ? "holiday-day" : ""
          ].filter(Boolean).join(" ");
          return (
            <div key={cell.key} className={cls}>
              <div className="date">{cell.day}</div>
              {cell.holidayName && (
                <div className="holiday">{cell.holidayName}</div>
              )}
            </div>
          );
        })}
      </div>

      <div className="cal-legend">
        <span>
          <span className="legend-dot legend-holiday"></span>èŠ‚å‡æ—¥ï¼ˆç¤ºä¾‹ï¼š2025 éƒ¨åˆ†ï¼‰
        </span>
        <span>
          <span className="legend-dot legend-today"></span>ä»Šæ—¥
        </span>
      </div>
    </div>
  );
}

// ===== å¤©æ°” + 24h è¶‹åŠ¿ç»„ä»¶ =====
function WeatherAndCalendar({ onFeelsLikeChange }) {
  const [location, setLocation] = useState(null);
  const [nowWeather, setNowWeather] = useState(null);
  const [hourly, setHourly] = useState([]);
  const [loading, setLoading] = useState(true);
  const [errorMsg, setErrorMsg] = useState(null);

  useEffect(() => {
    async function fetchWeatherByLatLon(lat, lon) {
      try {
        setLoading(true);
        setErrorMsg(null);

        const locParam = `${lon.toFixed(2)},${lat.toFixed(2)}`;

        // 1. åŸå¸‚åæŸ¥ â€”â€” ä½¿ç”¨ä½ çš„ä¸“å±åŸŸå
        const cityResp = await fetch(
          `https://mh7md9rpa5.re.qweatherapi.com/v2/city/lookup?location=${locParam}&key=${QWEATHER_KEY}`
        );
        const cityData = await cityResp.json();
        if (cityData.code !== "200" || !cityData.location || !cityData.location.length) {
          throw new Error("åŸå¸‚æŸ¥è¯¢å¤±è´¥ï¼š" + cityData.code);
        }
        const target = cityData.location[0];
        setLocation({ name: target.name, adm1: target.adm1 });

        // 2. 24 å°æ—¶å¤©æ°” â€”â€” åŒæ ·ä½¿ç”¨ä½ çš„åŸŸå
        const weatherResp = await fetch(
          `https://mh7md9rpa5.re.qweatherapi.com/v7/weather/24h?location=${target.id}&key=${QWEATHER_KEY}`
        );
        const weatherData = await weatherResp.json();
        if (weatherData.code !== "200" || !weatherData.hourly) {
          throw new Error("å¤©æ°”æŸ¥è¯¢å¤±è´¥ï¼š" + weatherData.code);
        }

        const list = weatherData.hourly;
        const first = list[0];
        const feels = Number(first.feelsLike);

        setNowWeather({
          temp: Number(first.temp),
          feelsLike: feels,
          text: first.text,
          obsTime: first.fxTime
        });
        setHourly(list.slice(0, 24));

        if (typeof onFeelsLikeChange === "function") {
          onFeelsLikeChange(feels);
        }
      } catch (err) {
        console.error(err);
        setErrorMsg(err.message || "è¯·æ±‚å¤±è´¥");
      } finally {
        setLoading(false);
      }
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => fetchWeatherByLatLon(pos.coords.latitude, pos.coords.longitude),
        () => fetchWeatherByLatLon(39.92, 116.41), // é»˜è®¤åŒ—äº¬
        { enableHighAccuracy: false, timeout: 4000 }
      );
    } else {
      fetchWeatherByLatLon(39.92, 116.41);
    }
  }, [onFeelsLikeChange]);

  // 24 å°æ—¶è¶‹åŠ¿æ•°æ®å¤„ç†
  let minTemp = null, maxTemp = null;
  const temps = hourly.map(h => Number(h.temp));
  if (temps.length) {
    minTemp = Math.min(...temps);
    maxTemp = Math.max(...temps);
  }
  const tempRange = maxTemp !== null ? (maxTemp - minTemp || 1) : 1;

  const points = hourly.map((h, idx) => {
    const x = (idx / Math.max(hourly.length - 1, 1)) * 100;
    const t = Number(h.temp);
    const y = 100 - ((t - minTemp) / tempRange) * 80 - 10;
    return `${x},${y}`;
  }).join(" ");

  return (
    <div className="weather-section">
      <div className="glass-card">
        <div className="weather-main">
          {loading && <div style={{ fontSize: 13 }}>æ­£åœ¨è·å–å®šä½ä¸å¤©æ°”æ•°æ®â€¦</div>}
          {errorMsg && (
            <div style={{ fontSize: 13, color: "#fca5a5" }}>
              è·å–å¤©æ°”å¤±è´¥ï¼š{errorMsg}ï¼ˆè¯·æ£€æŸ¥ key / åŸŸå / ç½‘ç»œï¼‰
            </div>
          )}
          {!loading && !errorMsg && nowWeather && (
            <>
              <div className="weather-top">
                <div>
                  <div className="weather-city">
                    {location?.name ?? "æœªçŸ¥åŸå¸‚"}
                  </div>
                  <div className="weather-desc">
                    {nowWeather.text} Â· æœªæ¥ 24 å°æ—¶è¶‹åŠ¿
                  </div>
                </div>
                <div className="weather-temp-block">
                  <div className="temp-now">
                    {nowWeather.temp.toFixed(0)}Â°
                  </div>
                  <div className="temp-feel">
                    ä½“æ„Ÿ {nowWeather.feelsLike.toFixed(0)}Â°C
                  </div>
                </div>
              </div>

              <div className="weather-meta">
                <span><span className="status-dot" />å®æ—¶å¤©æ°” Â· å’Œé£å¤©æ°”</span>
                {nowWeather.obsTime && (
                  <span>æœ€æ–°é¢„æŠ¥æ—¶é—´ï¼š{nowWeather.obsTime.replace("T", " ").slice(0, 16)}</span>
                )}
                {minTemp !== null && maxTemp !== null && (
                  <span>æœªæ¥ 24 å°æ—¶åŒºé—´ï¼š{minTemp.toFixed(0)}Â° ~ {maxTemp.toFixed(0)}Â°C</span>
                )}
              </div>
            </>
          )}
        </div>

        <div className="glass-card" style={{ marginTop: 10 }}>
          <div className="trend-title">
            <span>æœªæ¥ 24 å°æ—¶æ¸©åº¦è¶‹åŠ¿</span>
            <span style={{ fontSize: 11, color: "var(--txt-sub)" }}>
              æ¨ªè½´ï¼šæ—¶é—´ Â· çºµè½´ï¼šæ¸©åº¦ï¼ˆÂ°Cï¼‰
            </span>
          </div>
          <div className="trend-chart-wrapper">
            <svg viewBox="0 0 100 100" className="trend-svg" preserveAspectRatio="none">
              <line x1="0" y1="90" x2="100" y2="90" stroke="rgba(148,163,184,0.5)" strokeWidth="0.3" />
              {hourly.length > 1 && (
                <polyline
                  points={points}
                  fill="none"
                  stroke="url(#tempGradient)"
                  strokeWidth="1.2"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
              )}
              <defs>
                <linearGradient id="tempGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" stopColor="#60a5fa" />
                  <stop offset="50%" stopColor="#38bdf8" />
                  <stop offset="100%" stopColor="#fb923c" />
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div className="trend-labels">
            {hourly.length > 0 && (
              <>
                <span>{formatHourLabel(hourly[0].fxTime)}</span>
                <span>{formatHourLabel(hourly[Math.floor(hourly.length / 2)].fxTime)}</span>
                <span>{formatHourLabel(hourly[hourly.length - 1].fxTime)}</span>
              </>
            )}
          </div>
        </div>
      </div>

      <CalendarPanel />
    </div>
  );
}

// ===== ä¸»åº”ç”¨ =====
function WinterGlowApp() {
  const [scene, setScene] = useState("night");   // night / snow / dusk
  const [snowOn, setSnowOn] = useState(true);
  const [breatheOn, setBreatheOn] = useState(true);
  const [musicOn, setMusicOn] = useState(false);
  const [showStory, setShowStory] = useState(false);
  const [storyIndex, setStoryIndex] = useState(0);
  const [mood, setMood] = useState(50);          // 0 å†·é™, 100 ç‚½çƒ­
  const [feelsLike, setFeelsLike] = useState(null);

  const glowRef = useRef(null);
  const orbRef = useRef(null);
  const canvasRef = useRef(null);
  const audioRef = useRef(null);
  const smokeLayerRef = useRef(null);
  const orbWrapperRef = useRef(null);
  const threeMountRef = useRef(null);
  const threeStateRef = useRef(null);

  /* å…‰æ ‡ç§»åŠ¨ï¼šå…‰æ™• + çƒä½“å€¾æ–œ + ç²’å­å°¾è¿¹ */
  useEffect(() => {
    let lastParticleTime = 0;

    function spawnCursorParticle(x, y) {
      const el = document.createElement("div");
      el.className = "cursor-particle";
      const dx = (Math.random() - 0.5) * 40;
      const dy = (Math.random() - 0.5) * 40;
      el.style.setProperty("--dx", `${dx}px`);
      el.style.setProperty("--dy", `${dy}px`);
      el.style.left = `${x}px`;
      el.style.top = `${y}px`;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 700);
    }

    function handleMove(e) {
      const x = e.clientX - 110;
      const y = e.clientY - 110;
      if (glowRef.current) {
        glowRef.current.style.transform = `translate3d(${x}px, ${y}px, 0)`;
      }
      if (orbRef.current) {
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;
        const dx = (e.clientX - cx) / 40;
        const dy = (e.clientY - cy) / 40;
        orbRef.current.style.transform =
          `rotateX(${ -dy }deg) rotateY(${ dx }deg)`;
      }
      const now = performance.now();
      if (now - lastParticleTime > 35) {
        lastParticleTime = now;
        spawnCursorParticle(e.clientX, e.clientY);
      }
    }

    window.addEventListener("mousemove", handleMove);
    return () => window.removeEventListener("mousemove", handleMove);
  }, []);

  /* Canvas é›ªèŠ± */
  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext("2d");

    let width, height;
    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener("resize", resize);

    const flakes = Array.from({ length: 140 }).map(() => ({
      x: Math.random() * width,
      y: Math.random() * height,
      r: Math.random() * 2 + 1,
      speedY: Math.random() * 0.8 + 0.4,
      speedX: (Math.random() - 0.5) * 0.6
    }));

    let animationId;
    function render() {
      ctx.clearRect(0, 0, width, height);
      if (snowOn) {
        ctx.fillStyle = "rgba(248,250,252,0.9)";
        flakes.forEach(f => {
          f.y += f.speedY;
          f.x += f.speedX;
          if (f.y > height + 5) {
            f.y = -10;
            f.x = Math.random() * width;
          }
          if (f.x > width) f.x = 0;
          if (f.x < 0) f.x = width;
          ctx.beginPath();
          ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
          ctx.fill();
        });
      }
      animationId = requestAnimationFrame(render);
    }
    render();

    return () => {
      cancelAnimationFrame(animationId);
      window.removeEventListener("resize", resize);
    };
  }, [snowOn]);

  /* Three.js çƒä½“ç²’å­äº‘ */
  useEffect(() => {
    if (!threeMountRef.current || !THREE) return;

    const container = threeMountRef.current;
    const width = container.clientWidth || 200;
    const height = container.clientHeight || width;

    const scene3 = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(55, width / height, 0.1, 100);
    camera.position.z = 3;

    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(width, height);
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    container.innerHTML = "";
    container.appendChild(renderer.domElement);

    const geometry = new THREE.BufferGeometry();
    const num = 900;
    const positions = new Float32Array(num * 3);
    const velocities = new Float32Array(num * 3);

    for (let i = 0; i < num; i++) {
      const r = Math.random() * 1.2;
      const theta = Math.random() * 2 * Math.PI;
      const phi = Math.acos(2 * Math.random() - 1);
      const x = r * Math.sin(phi) * Math.cos(theta);
      const y = r * Math.sin(phi) * Math.sin(theta);
      const z = r * Math.cos(phi);
      positions[3 * i] = x;
      positions[3 * i + 1] = y;
      positions[3 * i + 2] = z;

      velocities[3 * i] = (Math.random() - 0.5) * 0.002;
      velocities[3 * i + 1] = (Math.random() - 0.5) * 0.002;
      velocities[3 * i + 2] = (Math.random() - 0.5) * 0.002;
    }

    geometry.setAttribute(
      "position",
      new THREE.BufferAttribute(positions, 3)
    );

    const material = new THREE.PointsMaterial({
      color: 0xffe7a3,
      size: 0.025,
      transparent: true,
      opacity: 0.9,
      sizeAttenuation: true
    });

    const points = new THREE.Points(geometry, material);
    scene3.add(points);

    let frameId;
    function animate() {
      frameId = requestAnimationFrame(animate);
      const pos = geometry.attributes.position.array;
      for (let i = 0; i < num; i++) {
        pos[3 * i] += velocities[3 * i];
        pos[3 * i + 1] += velocities[3 * i + 1];
        pos[3 * i + 2] += velocities[3 * i + 2];
        const dx = pos[3 * i];
        const dy = pos[3 * i + 1];
        const dz = pos[3 * i + 2];
        const d = Math.sqrt(dx * dx + dy * dy + dz * dz);
        if (d > 1.4) {
          pos[3 * i] *= 0.95;
          pos[3 * i + 1] *= 0.95;
          pos[3 * i + 2] *= 0.95;
        }
      }
      geometry.attributes.position.needsUpdate = true;
      points.rotation.y += 0.0018;
      points.rotation.x += 0.0009;
      renderer.render(scene3, camera);
    }
    animate();

    function handleResize() {
      const w = container.clientWidth || 200;
      const h = container.clientHeight || w;
      renderer.setSize(w, h);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    }
    window.addEventListener("resize", handleResize);

    threeStateRef.current = {
      renderer,
      scene3,
      camera,
      material,
      geometry,
      frameId
    };

    return () => {
      cancelAnimationFrame(frameId);
      window.removeEventListener("resize", handleResize);
      geometry.dispose();
      material.dispose();
      renderer.dispose();
      container.innerHTML = "";
    };
  }, []);

  /* æ ¹æ®åœºæ™¯è°ƒæ•´ç²’å­é¢œè‰² */
  useEffect(() => {
    const state = threeStateRef.current;
    if (!state) return;
    if (scene === "night") {
      state.material.color.set(0xffe7a3);
    } else if (scene === "snow") {
      state.material.color.set(0xc4e4ff);
    } else {
      state.material.color.set(0xffbf8b);
    }
  }, [scene]);

  /* æ°›å›´éŸ³ä¹ */
  useEffect(() => {
    if (!audioRef.current) {
      audioRef.current = new Audio(
        "https://samplelib.com/lib/preview/mp3/sample-3s.mp3"
      );
      audioRef.current.loop = true;
      audioRef.current.volume = 0.5;
    }
    if (musicOn) {
      audioRef.current.play().catch(() => {});
    } else {
      audioRef.current.pause();
    }
  }, [musicOn]);

  /* è§†å·®æ»šåŠ¨ */
  useEffect(() => {
    function onScroll() {
      const y = window.scrollY || 0;
      const offset = y * 0.05;
      if (smokeLayerRef.current) {
        smokeLayerRef.current.style.transform =
          `translate3d(0, ${-offset}px, 0)`;
      }
      if (orbWrapperRef.current) {
        orbWrapperRef.current.style.transform =
          `translate3d(0, ${offset * 0.6}px, 0)`;
      }
    }
    window.addEventListener("scroll", onScroll);
    onScroll();
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  const sceneLabel = {
    night: "é»‘å¤œ Â· Night",
    snow: "é›ªå¤œ Â· Snowy Night",
    dusk: "é»„æ˜ Â· Dusk Glow"
  }[scene];

  const moodLabel =
    mood < 30 ? "åå†·é™" :
    mood < 70 ? "å¹³ç¨³" : "åæ¸©æš–";

  const moodFilter = `hue-rotate(${(mood - 50) * 0.8}deg) saturate(${0.9 + mood/120}) brightness(${0.9 + mood/300})`;

  // æ ¹æ®åœºæ™¯ + ä½“æ„Ÿæ¸©åº¦è°ƒèŠ‚èƒŒæ™¯
  const tempMode = bgTempMode(feelsLike);
  let bg;
  if (scene === "night") {
    if (tempMode === "cold") {
      bg = `radial-gradient(circle at top, var(--bg-night-cold-2), var(--bg-night-cold-1), #000)`;
    } else if (tempMode === "warm") {
      bg = `radial-gradient(circle at top, var(--bg-night-warm-2), var(--bg-night-warm-1), #020617)`;
    } else {
      bg = `radial-gradient(circle at top, #111827, #020617)`;
    }
  } else if (scene === "snow") {
    if (tempMode === "cold") {
      bg = `radial-gradient(circle at top, var(--bg-snow-cold-2), var(--bg-snow-cold-1), #020617)`;
    } else if (tempMode === "warm") {
      bg = `radial-gradient(circle at top, var(--bg-snow-warm-2), var(--bg-snow-warm-1), #020617)`;
    } else {
      bg = `radial-gradient(circle at top, #1f2937, #020617)`;
    }
  } else {
    if (tempMode === "cold") {
      bg = `radial-gradient(circle at top, var(--bg-dusk-cold-2), var(--bg-dusk-cold-1), #020617)`;
    } else if (tempMode === "warm") {
      bg = `radial-gradient(circle at top, var(--bg-dusk-warm-2), var(--bg-dusk-warm-1), #020617)`;
    } else {
      bg = `radial-gradient(circle at top, #7c2d12, #1e1b4b)`;
    }
  }

  const storyPages = [
    {
      title: "å†¬å¤œå°æ•…äº‹ Â· 1",
      sub: "â€œå¤ªæ™šäº†ï¼Œè¿˜ä¸å›å»å—ï¼Ÿâ€",
      lines: [
        { who: "èˆå‹", text: "å¤–é¢é£è¶…å¤§ï¼Œä½ ä»Šæ™šè¿˜è¦åœ¨è‡ªä¹ å®¤å¾…å¤šä¹…ï¼Ÿ" },
        { who: "ä½ ", text: "å†çœ‹ä¸€çœ¼é¢˜ç›®å°±èµ°ï¼Œé©¬ä¸Šå°±å›å»äº†ã€‚" },
        { who: "æ—ç™½", text: "ç«™èµ·æ¥çš„æ—¶å€™ï¼Œä½ å‘ç°æ‰‹æœºä¸Šå¤šäº†ä¸€æ¡æ¶ˆæ¯â€”â€”" },
        { who: "æ¶ˆæ¯", text: "ã€åˆ°å®¿èˆè®°å¾—å›æˆ‘ï¼Œè¯´ä¸€å£°ä½ å®‰å…¨åˆ°å•¦ã€‚ã€" }
      ]
    },
    {
      title: "å†¬å¤œå°æ•…äº‹ Â· 2",
      sub: "â€œæ‰‹æœºçš„å…‰ï¼Œæ¯”è·¯ç¯è¿˜äº®ä¸€ç‚¹ã€‚â€",
      lines: [
        { who: "æ—ç™½", text: "ä½ æŠŠå›´å·¾æ‹‰é«˜äº†ä¸€ç‚¹ï¼Œå‘¼å‡ºæ¥çš„ç™½æ°”åœ¨å†·ç©ºæ°”é‡Œæ¶ˆæ•£ã€‚" },
        { who: "è·¯ç¯", text: "æ˜é»„çš„å…‰è½åœ¨é›ªåœ°ä¸Šï¼Œåƒè¢«äººè½»è½»æ¶‚å¼€çš„æ©˜è‰²é¢œæ–™ã€‚" },
        { who: "ä½ ", text: "ä¸çŸ¥æ€ä¹ˆçš„ï¼Œåˆšæ‰é‚£æ¡æ¶ˆæ¯åœ¨è„‘å­é‡Œå¾ªç¯æ’­æ”¾ã€‚" },
        { who: "å¿ƒé‡Œ", text: "åŸæ¥æœ‰äººåœ¨æ„ä½ ä»Šæ™šæœ‰æ²¡æœ‰å¥½å¥½åˆ°å®¶ï¼Œè¿™ä»¶äº‹æœ¬èº«ï¼Œå°±å·²ç»å¾ˆæš–äº†ã€‚" }
      ]
    },
    {
      title: "å†¬å¤œå°æ•…äº‹ Â· 3",
      sub: "â€œæ€»ä¼šæœ‰äººï¼ŒæŠŠä½ å½“æˆä¸€ä»¶éœ€è¦å°å¿ƒæ”¶å¥½çš„ä¸œè¥¿ã€‚â€",
      lines: [
        { who: "ä½ ", text: "åˆ°å®¿èˆäº†ï¼Œåˆšæ´—å®Œæ‰‹ã€‚ä»Šå¤©é£çœŸæŒºå¤§çš„ã€‚" },
        { who: "å¯¹æ–¹", text: "å¥½ï¼Œæ—©ç‚¹ä¼‘æ¯ï¼Œåˆ«ç†¬å¤ªæ™šã€‚æ™šå®‰ï½" },
        { who: "æ—ç™½", text: "ä½ æŠŠæ‰‹æœºå±å¹•æ‰£åœ¨æ¡Œä¸Šï¼Œæˆ¿é—´çš„ç¯ä¹Ÿä¸€ç‚¹ç‚¹æš—ä¸‹æ¥ã€‚" },
        { who: "æ—ç™½", text: "çª—å¤–è¿˜æ˜¯å¾ˆå†·ï¼Œä½†ä½ çªç„¶è§‰å¾—ï¼Œè¿™ä¸ªå†¬å¤©ï¼Œå¥½åƒä¹Ÿæ²¡æœ‰é‚£ä¹ˆéš¾ç†¬ã€‚" }
      ]
    }
  ];
  const currentStory = storyPages[storyIndex];

  return (
    <>
      {/* å…‰æ ‡å…‰æ™• */}
      <div className="cursor-glow" ref={glowRef} />

      {/* Canvas é›ªèŠ± */}
      <canvas ref={canvasRef} className="snow-canvas" />

      {/* çƒŸé›¾å±‚ */}
      <div className="smoke-layer" ref={smokeLayerRef}>
        <div className="smoke-cloud" />
        <div className="smoke-cloud smoke-2" />
      </div>

      {/* ä¸»å®¹å™¨ */}
      <div className="app" style={{ background: bg, filter: moodFilter }}>
        <div className="top-bar">
          <div className="logo-block">
            <div className="logo-mark" />
            <div>
              <div className="logo-text-main">Winter Glow</div>
              <div className="logo-text-sub">å†¬å¤©ç»™äºˆæ¸©æš– Â· UI ä½“éªŒå®éªŒ</div>
            </div>
          </div>

          <div className="top-right">
            <span className="small-text">{sceneLabel}</span>
            <button
              className="glass-btn small"
              onClick={() => { setShowStory(true); setStoryIndex(0); }}
            >
              <span className="dot-live" />
              æ‰“å¼€å¤šé¡µå†¬å¤œæ•…äº‹
            </button>
          </div>
        </div>

        {/* ä¸Šæ–¹åŸæœ‰ç‰¹æ•ˆåŒºåŸŸ */}
        <div className="content">
          <div className="left">
            <div className="tag-line">
              å†¬æ—¥ Â· æƒ…ç»ª Â· å…‰çš„å®éªŒæ€§é¡µé¢
              <span className="tag-pill">winter Â· warm Â· react + three.js</span>
            </div>

            <div className="title">
              è®©<span className="t-cold">æœ€å†·çš„å¤œ</span>ï¼Œ<br />
              ä¹Ÿå› ä¸º<span className="t-warm">ä¸€ç‚¹ç‚¹å¾®å…‰</span>è€Œå˜å¾—æŸ”è½¯ã€‚
            </div>

            <div className="subtitle">
              æœ‰æ—¶å€™ï¼Œä½ éœ€è¦çš„ä¸æ˜¯æ•´åº§åŸå¸‚çš„ç¯ç«ï¼Œè€Œæ˜¯
              <strong>ä¸€æŸæ©˜é»„è‰²çš„å…‰</strong>ã€<strong>ä¸€å£çƒ­æ°”</strong>ï¼Œ
              æˆ–è€…æ¥è‡ªå¾ˆè¿œå¾ˆè¿œçš„ä¸€å¥ï¼šâ€œæ™šä¸Šè®°å¾—å¤šç©¿ä¸€ç‚¹ã€‚â€<br />
              è¿™ä¸ªé¡µé¢å°è¯•æŠŠé‚£ç§è¢«ä¸–ç•Œè½»è½»æ¥ä½çš„æ„Ÿè§‰ï¼Œåšæˆå¯ä»¥ç‚¹äº®å’Œè°ƒèŠ‚çš„ç•Œé¢ã€‚
            </div>

            <div className="button-row">
              <button className="glass-btn" onClick={() => setScene("night")}>ğŸŒŒ é»‘å¤œåœºæ™¯</button>
              <button className="glass-btn" onClick={() => setScene("snow")}>â„ï¸ é›ªå¤œåœºæ™¯</button>
              <button className="glass-btn" onClick={() => setScene("dusk")}>ğŸŒ‡ é»„æ˜åœºæ™¯</button>
            </div>

            <div className="button-row">
              <button className="glass-btn small" onClick={() => setSnowOn(v => !v)}>
                {snowOn ? "â›… æš‚åœé£˜é›ª" : "â„ï¸ å¼€å¯é£˜é›ª"}
              </button>
              <button className="glass-btn small" onClick={() => setBreatheOn(v => !v)}>
                {breatheOn ? "ğŸ’¤ å…³é—­å‘¼å¸å…‰" : "âœ¨ å¼€å¯å‘¼å¸å…‰"}
              </button>
              <button className="glass-btn small" onClick={() => setMusicOn(v => !v)}>
                {musicOn ? "ğŸ”‡ å…³é—­æ°›å›´éŸ³ä¹" : "ğŸ§ æ‰“å¼€æ°›å›´éŸ³ä¹"}
              </button>
            </div>

            <div className="mood-row">
              <span>å¿ƒæƒ…ï¼š</span>
              <input
                type="range"
                min="0"
                max="100"
                value={mood}
                onChange={e => setMood(Number(e.target.value))}
              />
              <span>{moodLabel}</span>
            </div>

            <div className="hint-text">
              <span className="hint-badge">å°æç¤º</span>
              å»ºè®®é™é™ç›¯ç€çƒä½“ 15 ç§’ï¼Œçœ‹ç²’å­åœ¨å†…éƒ¨ç¼“æ…¢æ—‹è½¬ï¼Œ
              åƒä¸€å›¢æ°¸è¿œä¸ä¼šç†„ç­çš„å°å¤ªé˜³ã€‚
            </div>
          </div>

          <div className="right">
            <div className="orb-wrapper" ref={orbWrapperRef}>
              <div className={`orb ${breatheOn ? "orb-breathe" : ""}`} ref={orbRef}>
                <div className="orb-three-layer" ref={threeMountRef} />
              </div>
              <div className="dot-cloud" />
              <div className="dot-ring" />
              <div className="orb-card">
                <div className="orb-card-title">
                  å†¬å¤œæ¸©åº¦æ¡£æ¡ˆ
                  <span className="orb-card-badge">æš–åŒº</span>
                </div>
                <div className="orb-card-temp">
                  ä½“æ„Ÿæ¸©åº¦ï¼šåŠ¨æ€æ¥è‡ªå¤©æ°”æ¥å£
                  {feelsLike != null && ` Â· å½“å‰ ${feelsLike.toFixed(0)}Â°C`}
                </div>
                <div>
                  æ¥æºï¼šçƒ­é¥® / æ£‰è¢« / å±å¹•å‰è®¤çœŸçœ‹å®Œè¿™è¡Œå­—çš„ä½ ã€‚
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* æ–°å¢ï¼šå¤©æ°” + æ—¥å†åŒºå— */}
        <WeatherAndCalendar onFeelsLikeChange={setFeelsLike} />

        {/* ä¸‹æ–¹æ–‡å­—è¯´æ˜ */}
        <div className="story-scroll">
          æœ‰æ—¶å€™æˆ‘ä»¬ä¼šè§‰å¾—ï¼Œå†¬å¤©æ˜¯æ¼«é•¿ã€å†·ã€éš¾ç†¬çš„ã€‚å…¶å®å¾ˆå¤šè®°å¿†ï¼Œ
          éƒ½å‘ç”Ÿåœ¨è¿™æ ·çš„å­£èŠ‚é‡Œï¼šç¬¬ä¸€æ¬¡ç†¬å¤œèµ¶é¡¹ç›®ã€ç¬¬ä¸€æ¬¡å’Œæœ‹å‹å‡Œæ™¨
          å»ä¾¿åˆ©åº—ä¹°çƒ­é¥®ã€ç¬¬ä¸€æ¬¡æ„è¯†åˆ°â€œåŸæ¥æœ‰äººä¼šåœ¨æˆ‘å›å¯å®¤çš„æ—¶å€™ç­‰ä¸€æ¡æ¶ˆæ¯â€ã€‚<br /><br />
          ä½ å¯ä»¥æŠŠè¿™ä¸ªé¡µé¢å½“æˆä¸€ä¸ªå°å°çš„ã€ä¸ä¼šæ‰“æ‰°åˆ«äººçš„å†¬å¤œå®éªŒå®¤ï¼š
          è°ƒæ•´åœºæ™¯ã€æ”¹æ”¹å¿ƒæƒ…æ»‘æ†ã€å…³æ‰æˆ–æ‰“å¼€éŸ³ä¹ï¼Œå†çœ‹çœ‹ä¸‹é¢çš„å¤©æ°”å’Œæ—¥å†ï¼Œ
          æƒ³ä¸€æƒ³æ¥ä¸‹æ¥å‡ å¤©è¦åšçš„äº‹ã€‚<br />
          å½“ä½ æŸå¤©åˆ·åˆ°è¿™é‡Œï¼Œå“ªæ€•åªæ˜¯åœç•™å‡ ç§’ï¼Œä¹Ÿè®¸å°±å¤Ÿäº†ã€‚
          <div className="footer-note">
            æç¤ºï¼šèŠ‚å‡æ—¥ç¤ºä¾‹æŒ‰ 2025 éƒ¨åˆ†æ—¥æœŸæ‰‹åŠ¨é…ç½®ï¼Œåªç”¨äºæ¼”ç¤ºï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­ç»§ç»­è¡¥å…¨éƒ¨åˆ†å¹´ä»½çš„èŠ‚å‡æ—¥è¡¨ã€‚
          </div>
        </div>
      </div>

      {/* å¤šé¡µæ•…äº‹å¼¹çª— */}
      {showStory && (
        <div className="modal-backdrop" onClick={() => setShowStory(false)}>
          <div className="modal" onClick={e => e.stopPropagation()}>
            <div className="modal-title">{currentStory.title}</div>
            <div className="modal-sub">{currentStory.sub}</div>
            <div className="modal-body">
              {currentStory.lines.map((line, idx) => (
                <div className="dialog-line" key={idx}>
                  <span className="dialog-speaker">[{line.who}]</span>
                  <span>{line.text}</span>
                </div>
              ))}
            </div>
            <div className="modal-footer">
              <div className="progress-dots">
                {storyPages.map((_, idx) => (
                  <div
                    key={idx}
                    className={`dot ${idx === storyIndex ? "active" : ""}`}
                  />
                ))}
              </div>
              <div className="modal-btn-row">
                <button
                  className="glass-btn small"
                  disabled={storyIndex === 0}
                  onClick={() => setStoryIndex(i => Math.max(0, i - 1))}
                >
                  â—€ ä¸Šä¸€é¡µ
                </button>
                {storyIndex < storyPages.length - 1 ? (
                  <button
                    className="glass-btn small"
                    onClick={() => setStoryIndex(i => Math.min(storyPages.length - 1, i + 1))}
                  >
                    ä¸‹ä¸€é¡µ â–¶
                  </button>
                ) : (
                  <button
                    className="glass-btn small"
                    onClick={() => setShowStory(false)}
                  >
                    è¯»å®Œå•¦ Â· å…³æ‰
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
      )}
    </>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<WinterGlowApp />);
</script>
</body>
</html>
